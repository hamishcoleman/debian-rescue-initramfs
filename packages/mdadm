#!/bin/bash

DEBOOT="$1"
ARCH="$2"
STAGE="$3"

FILES_LIST="
r   /sbin/mdmon
"
# TODO
# - /etc/cron.d
# - /etc/init.d
# - /etc/logcheck
# - /etc/default/mdam START_DAEMON=false
# - /etc/mdadm
# - /usr/share/bug
# - /usr/share/doc-base/mdadm-*
# - /usr/share/initramfs-tools/hooks/mdadm
# - /usr/share/initramfs-tools/scripts/local-top/mdadm

# /usr/share/doc, /usr/share/locale and /usr/share/man
# are all dealt with centrally


if [ "$STAGE" = "minimise" ]; then
    # remove files
    echo "$FILES_LIST" | while read action file; do
        case "$action" in
        r)  eval rm -f "${DEBOOT}/$file"
            ;;
        esac
    done
elif [ "$STAGE" = "fixup" ]; then
    # The rescue system just wants the mdadm tools, not the running daemon
    # TODO - does this actually belong in the fixup phase?
    perl -pi -e 's/START_DAEMON=true/START_DAEMON=false/' ${DEBOOT}/etc/default/mdadm
else
    # unsupported stage
    exit 1
fi

