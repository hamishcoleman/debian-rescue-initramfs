#!/bin/bash

DEBOOT="$1"
ARCH="$2"
STAGE="$3"

DEL="
    /etc/apt/apt.conf.d/01autoremove
    /etc/cron.daily/apt-compat
    /etc/kernel/postinst.d/apt-auto-removal
    /etc/logrotate.d/apt
    /lib/systemd/system/apt-daily.service
    /lib/systemd/system/apt-daily.timer
    /usr/bin/apt-cdrom
    /usr/bin/apt-key
    /usr/bin/apt-mark
    /usr/lib/apt/apt.systemd.daily
    /usr/lib/apt/methods/cdrom
    /usr/lib/apt/methods/ftp
    /usr/lib/apt/methods/mirror
    /usr/lib/apt/methods/rred
    /usr/lib/apt/methods/rsh
    /usr/lib/apt/methods/ssh
    /usr/share/bug/apt/script
    /var/cache/apt/pkgcache.bin
    /var/cache/apt/srcpkgcache.bin
    /var/lib/apt/lists/lock
"

DEL2="
    $DEBOOT/var/cache/apt/archives/*.deb
    $DEBOOT/var/lib/apt/lists/*_Release
    $DEBOOT/var/lib/apt/lists/*_Release.gpg
    $DEBOOT/var/lib/apt/lists/*_Packages
    $DEBOOT/var/lib/apt/lists/*_Translation-*
    $DEBOOT/var/lib/apt/lists/*_Sources
"

# /usr/share/doc, /usr/share/locale and /usr/share/man
# are all dealt with centrally


if [ "$STAGE" = "minimise" ]; then
    # remove files
    for i in $DEL; do
        rm -f $DEBOOT/$i
    done
    rm -f $DEL2
else
    # unsupported stage
    exit 1
fi

