#!/bin/bash

DEBOOT="$1"
ARCH="$2"
STAGE="$3"

DEL="
    /bin/loginctl
    /bin/machinectl
    /bin/systemd-inhibit
    /usr/bin/busctl
    /usr/bin/hostnamectl
    /usr/bin/localectl
    /usr/bin/systemd-cgls
    /usr/bin/timedatectl
    /lib/systemd/systemd-networkd
    /lib/systemd/systemd-timedated
    /lib/systemd/systemd-localed
    /lib/systemd/systemd-hostnamed
    /lib/systemd/system/systemd-modules-load.service
"


if [ "$STAGE" = "minimise" ]; then
    # remove files
    for i in $DEL; do
        rm -f $DEBOOT/$i
    done
elif [ "$STAGE" = "fixup" ]; then
    # the initrd looks for a different file to start as init than
    # a normal bootup.  # so, we need to specifically create a link
    # for it.
    ln -fs sbin/init $DEBOOT/init
else
    # unsupported stage
    exit 1
fi

