#!/bin/bash

DEBOOT="$1"
ARCH="$2"
STAGE="$3"

FILES_LIST="
r   /bin/dir
r   /bin/true
r   /bin/vdir
r   /usr/bin/chcon
r   /usr/bin/comm
r   /usr/bin/csplit
r   /usr/bin/expand
r   /usr/bin/factor
r   /usr/bin/fmt
r   /usr/bin/fold
r   /usr/bin/groups
r   /usr/bin/hostid
r   /usr/bin/join
r   /usr/bin/link
r   /usr/bin/nl
r   /usr/bin/nproc
r   /usr/bin/od
r   /usr/bin/paste
r   /usr/bin/pathchk
r   /usr/bin/pr
r   /usr/bin/ptx
r   /usr/bin/runcon
r   /usr/bin/sha224sum
r   /usr/bin/sha256sum
r   /usr/bin/sha384sum
r   /usr/bin/shuf
r   /usr/bin/stdbuf
r   /usr/bin/tac
r   /usr/bin/tsort
r   /usr/bin/unexpand
r   /usr/bin/unlink
r   /usr/bin/users
r   /usr/bin/who
"
# FIXME
# - keep at least sha256sum, now that sha1 is breaking
# TODO
# - /usr/lib/coreutils/libstdbuf.so

# /usr/share/doc, /usr/share/info and /usr/share/man are all dealt with
# centrally


if [ "$STAGE" = "minimise" ]; then
    # remove files
    echo "$FILES_LIST" | while read action file; do
        case "$action" in
        r)  eval rm -f "${DEBOOT}/$file"
            ;;
        esac
    done


    # A zero byte exe returns a success errorcode
    touch $DEBOOT/bin/true
    chmod a=rx $DEBOOT/bin/true
else
    # unsupported stage
    exit 1
fi

