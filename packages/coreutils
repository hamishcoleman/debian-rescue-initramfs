#!/bin/bash

DEBOOT="$1"
ARCH="$2"
STAGE="$3"

DEL="
    /bin/dir
    /bin/true
    /bin/vdir
    /usr/bin/chcon
    /usr/bin/comm
    /usr/bin/csplit
    /usr/bin/expand
    /usr/bin/factor
    /usr/bin/fmt
    /usr/bin/fold
    /usr/bin/groups
    /usr/bin/hostid
    /usr/bin/join
    /usr/bin/link
    /usr/bin/nl
    /usr/bin/nproc
    /usr/bin/od
    /usr/bin/paste
    /usr/bin/pathchk
    /usr/bin/pr
    /usr/bin/ptx
    /usr/bin/runcon
    /usr/bin/sha224sum
    /usr/bin/sha256sum
    /usr/bin/sha384sum
    /usr/bin/shuf
    /usr/bin/stdbuf
    /usr/bin/tac
    /usr/bin/tsort
    /usr/bin/unexpand
    /usr/bin/unlink
    /usr/bin/users
    /usr/bin/who
"
# FIXME
# - keep at least sha256sum, now that sha1 is breaking
# TODO
# - /usr/lib/coreutils/libstdbuf.so

# /usr/share/doc, /usr/share/info and /usr/share/man are all dealt with
# centrally


if [ "$STAGE" = "minimise" ]; then
    # remove files
    for i in $DEL; do
        rm -f $DEBOOT/$i
    done

    # A zero byte exe returns a success errorcode
    touch $DEBOOT/bin/true
    chmod a=rx $DEBOOT/bin/true
else
    echo ERROR: unknown stage
    exit 1
fi

